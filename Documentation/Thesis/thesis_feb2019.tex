\documentclass[12pt]{report}
\author{Nicholas Berezny}
\title{Thesis Outline}
\usepackage{cite}
\usepackage{fullpage}
\usepackage{gensymb}
\usepackage{}
\renewcommand{\baselinestretch}{1.5} 

\usepackage{amsmath}
\usepackage{graphicx}
\graphicspath{ {pics/} }
\usepackage{svg}

\begin{document}
\maketitle
\newpage

\chapter{Literature Review and Preliminary Research}

\section{Stroke and Rehabilitation}

Stroke is a cerebrovascular disease which effects approximately 62,000 Canadians and 795,000 Americans each year \cite{Benjamin2018,Hebert2016}. It is among the leading casuses of adult disability \cite{Ewart2003}, with some form of motor impairment effecting 80\% of patients, which can result in limited mobility and muscle control \cite{Langhorne2009}. Ischaemic stroke is the most common form of stroke, accounting for around 80\% of all cases \cite{Rey2008}. It is caused by blood vessel occlusion, either directly in the brain (thrombotic), or due to the migration of a clot formed somewhere else in the body (embolic). The subsequent lack of oxygen causes the death of brain tissue and neurological deficits \cite{Prabhakaran2015}, which manifest as functional impairments in activities associated with the affected brain region. Stroke complications can include hemiparesis (weakness on one side of the body), muscle spacitity, loss of motor control, loss of dexterity, which can effect the patient's ability to perform activities of daily living (ADL's) and compromise their autonomy. In addition to medical intervention in the form of pharmaceuticals and surgery, the stroke patient may require rehabilitation to reduce functional impairment \cite{Stroke}. It is imperative to administer treatment during the acute phase of the stroke (\textit{i.e.} within days of the stroke) \cite{Prabhakaran2015}.

%----
%Approximately 62,000 Canadians suffer from stroke every year, with over 10\% of victims requiring in-patient rehabilitation \cite{Benjamin2018,Hebert2016}. It is among the leading casuses of adult disability \cite{Ewart2003}. Motor impairment effects around 80\% of patients, which can result in limited mobilited and muscle control \cite{Langhorne2009}. The scale of stroke care and rehabilitation is significant, with ... Improving stroke rehabilitation would benefit the stroke victims by improving their recovery and thus their quality of life, and would also have significant economic benefits, with one study estimating up to \$682 million dollars annually in Canada alone, due to savings due to earlier discharges, as well as increased productivity of the stroke patients post-treatment \cite{Krueger2012}. 
%----

%Ischaemic stroke is the most common form of stroke, accounting for around 80\% of all cases \cite{Rey2008}. It is caused by blood vessel occlusion, either directly in the brain (thrombotic), or due to the migration of a clot formed somewhere else in the body (embolic). The subsequent lack of oxygen in the affected area of the brain causes the death of brain tissue and neurological deficits \cite{Prabhakaran2015}, which manifest as functional impairments in the patient in activities associated with the affected brain region. Stroke complications can include hemiparesis (weakness on one side of the body), muscle spacitity, loss of motor control, loss of dexterity, etc... In addition to medical intervention in the form of pharmaceuticals and surgery, the stroke patient may require rehabilitation to reduce functional impairment and, ideally, to recover full autonomy \cite{Stroke}.

Older treatment techniques relied on compensatory measures to assist stroke patients in regaining autonomy \cite{Dobkin2004}. Rehabilitation began to be emphasized instead once the concept of neural plasticity became more widely accepted. Neural plasticity is the process by which new connections are formed in the central nervous system in response to experience or activities performed by the subject \cite{Warraich2010}. When a stroke patient repetitively performs motor tasks, new neural connections in the brain are formed which take on the role of the regions of the brain which were damaged. This allows the patient to re-learn tasks such as walking by going through intensive rehabilitation. 

%Rehabilitation of lost abilities began to be emphasized over compensatory measures due to the discovery of neural plasticity and its role in the process of learning new tasks. The basis of this neural plasticity is the formation of new neural connection in the brain in response to a repeated movement or activity. In the case of stroke, this allows new neurons to take on the role of damaged regions in the brain, allowing the patient to effectively re-learn tasks such as walking. 

Stroke rehabilitation encompasses a broad range of therapeutic activities, typically carried out by occupational- and physiotherapists. Physiotherapists (PT's) tend to focus on gross motor movements in the upper and lower limbs, while occupational therapists (OT's) focus on fine motor control, dexterity, and specific ADL's. These two goals are inextricably linked, and so both PT's and OT's typically form a team which works together to improve patient outcomes. The rehabilitation carried out by both OT's and PT's involves the repetition of a target movement or task. Depending on the abilities of the patient, the therapist may provide support or assistance. For example, typical lower-limb rehabilitation begins with simple legs movement performed in bed, such as knee flexion/extension, leg lifts, hip abductions, \textit{etc} [include pictures]. The therapist can either assist the patients leg through the movement, or allow patients to perform the movement on their own, or even provide light resistance if the patient is more advanced. Next, the patient will practice sitting upright, going from sit to stand, and  practice bearing weight and balancing while standing. Eventually the patients will be ready for more complex tasks with assistance from the therapist, including walking, heel strike, and stair climbing. The patient may advance to the point where they can walk without therapist assistance, using either parallel bars, a walker, or potentially without any assistance. These typical stages of lower-limb rehabilitation are summarized below:

\begin{enumerate}
	\item Bed-bound exercises with assistance
	\item Sit-to-stand and weight bearing
	\item Assisted gait therapy (with therapist moving the leg through the gait trajectory)
	\item Other out-of-bed activities, such as heel strike, stair climbing, etc.
	\item Walking without therapist assistance (using parallel bars or a walker)
\end{enumerate}



\subsection{Rehabilitation Guidelines}

Canadian stroke best practices recommend that therapy involves the repetition of intensive, task-specific activities in a complex and stimulating environment \cite{Hebert2016}. Lower-limb rehabilitation should be goal-orientated towards selected tasks such as walking and sit-to-stand. Robotics, virtual reality, and biofeedback are all mentioned as potential adjuncts, but are not recommended to replace traditional therapy. It is also recommended that patient's should receive rehabilitation as early as possible once they are deemed medically ready. Early mobilisation is recommended (within 24-48 hours of stroke, \cite{Casaubon2016}, but not before 24 hours due to findings that this actually reduces functional outcomes, \cite{AVERTTrialCollaborationgroup2015}). Active participation on the part of the patient is also imperative [4], as it has been found that this facilitates neural plasticity. This requires that the patient be engaged in the therapy (hence the need for stimulating environments), and also requires that the therapist ensures that the rehabilitation is not passive, \textit{i.e.} that the patient is not simply allowing the therapist to move their limb through the motion, but are actively contributing. 

The therapy dosage also has an effect on functional outcomes. For example, one study found positive correlation between time scheduled for therapy and outcomes \cite{Lohse2014}. Another study sought to determine if current doses of rehabilitation are enough to trigger functional improvements by comparing with animal models \cite{Lang2009}, and found that the amount of rehabilitation they observed was inadequate. Another study found that stroke inpatients spend on average 13\% engaged in physical activities and 5.2\% of their time with a therapist \cite{Bernhardt2004}. Other studies confirm that stroke patients significant amount of time is spent in or sitting near the bed \cite{King2011}. 

Other factors may restrict the PT's and OT's ability to accomplish the recommended best practices. The intensity and duration of the therapy is limited both by the endurance of the patient and of the therapist, as the physical burden of manually assisting the patient may be high \cite{Colombo}. Furthermore, providing task-specific and stimulating therapy is difficult, particularly when doing bed-bound exercises which are not easily relatable to ADL's. One study found that therapy dosage may be affected by understaffed units, resulting in less rehabilitation time with therapists \cite{Mchugh2013}.


%-----
%Guidelines stipulated in \cite{Hebert2016} express the need for prompt lower-limb rehabilitation, beginning ideally within days of the stroke. This is denoted the ``acute'' phase, as opposed to the ``chronic'' phase which refers to longer-term rehabilitation. The importance of acute stroke rehabilitation has been emphasized in the above guidelines and others like it as a way to improve patient outcomes. This is attributed in part to the brain's greater receptivity to changes through neural plasticity, a mechanism triggered through rehabilitation. However, starting therapy earlier may be more difficult, given that the complications are generally more pronounced. Guidelines also recommend that therapy is intensive, task-specific, and engaging \cite{Hebert2016}.  The intensity and duration of therapy may be limited by the endurance of the patient, as well as the physical burden that manually assistance places on the therapist. The frequency of therapy may also be limited by the busy schedules of PT's and OT's. 



 %Providing physical support and assistance to patient's can be burdensome for the therapist, especially when transferring patients out of bed and standing them up. The repetitive nature of rehabilitation can also be physically demanding. 


%The rehabilitation carried out by both OT's and PT's involves the repetition of a target movement or task. Depending on the abilities of the patient, the therapist may provide support or assistance. For example, typical lower-limb rehabilitation begins with simple legs movement performed in bed, such as knee flexion/extension, leg lifts, hip abductions, \textit{etc}. The therapist can either assist the patients leg through the movement, or allow patients to perform the movement on their own, or even provide light resistance if the patient is more advanced. Providing physical support and assistance to patient's can be burdensome for the therapist, especially when transferring patients out of bed and standing them up. The repetitive nature of rehabilitation can also be physically demanding. 

%A stroke patient's progress is monitored through tests, surveys, and measures...

%Inpatient's at the hospital may be discharged without having fully recovered from their impairments. They may seek outpatient clinics for further, chronic stroke rehabilitation. Many never fully recover the ability to perform all of their necessary ADL's (ref). This fact, coupled with the increasing rates of stroke, has spurred a variety of active research into improvements to current stroke intervention, and novel ways of administering rehabilitation. 

%% OLD 
%It is recommended that patients receive three hours a day of therapy, with more therapy generally leading to better outcomes. Exercises should be task-specific, meaningful, and related to activities of daily living. Giving the patient chances to repeat the exercises (under supervision) is also recommended.  The guidelines also explicitly mention both robotic devices and virtual reality training as potential tools for rehabilitation, although they should be used in addition to traditional therapy and not as replacements.  


\section{Robotic Rehabilitation}

	Rehabilitation robots have been introduced improve the stroke rehabilitation process by automating the physical assistance usually supplied by therapists. Rehabilitation typically requires the repetition of a motion, a task well-suited to robotics. Over the past few decades, a variety of robotic platforms have been developed for many different therapeutic activities, from lower-limb gait training to fine motor skills in the hand. There are many other potential benefits for using robotics for rehabilitation, including the following.
\begin{itemize}
	\item \textbf{Relieving Physical Burden}: Using robots to provide the physical support and assistance required for stroke therapy will relieve the physical burden from therapists, removing the chance of injury or fatigue.
	\item \textbf{Increased Intensity and Duration}: Both the intensity and duration of a therapy session may be limited when relying on a therapist to provide physical assistance. With a robot, duration and intensity would only be limited by the patient. 
	\item \textbf{Increased Dosage}: Robots could also increase the amount of rehabilitation given to patients. For example, a single therapist could supervise several patient's each using a robotic device, therefore increasing the number of patients a therapist can manage.
	\item \textbf{Providing Performance Measures}: Robots record a number of metrics not available when using traditional therapy, such as velocity, force, trajectory error, and effort. Tracking these measures could allow the therapist to better administrate therapy and track patient improvement. 
	\item \textbf{Virtual Environments}: Patient engagement could be increased by incorporating virtual reality, games, and other forms of visual feedback. The robot would serve as the control input to the environment. The relevancy of the therapy could also be improved by simulating ADL's. Finally, haptic feedback could further immerse the patient in the virtual environment by rendering virtual forces to the patient (see section \ref{Sec:VR}).
\end{itemize}
	

	Rehabilitation robots can be broadly categorized as targeting the lower-limb or the upper-limb (ref). Upper-limb robots tend to be lighter weight since they encounter much smaller loads, while lower-limb devices are heavier as they need to support either the weight of the leg or of the entire body. Lower-limb robots can be further categorized as either targeting standing activities such as treadmill walking, or lying/sitting activities. A final subdivision exists between endplate based devices and exoskeletal devices. Endplate-based devices interact with the patient at a single point, usually the end of the limb (the hand or foot), and only apply forces through this point. Exoskeletal devices attach to the user at multiple points, offering greater control over the overall motion of the limb, although they are often more restrictive, more complex, and potentially less safe \cite{Chang2013}. One study found evidence that endplate-based devices may actually yield better outcomes than exoskeletal devices, although the comparison was done via meta-analysis of many different studies with significantly different methodologies \cite{Mehrholz2012} . 
	
	Rehabilitation robots have not yet been fully endorsed by stroke best practices. For example, Canadian best practices list robots as a potential benefit, but do not recommend they replace traditional therapy \cite{Hebert2016}. This is largely due to the limited evidence for outcomes of robotic rehabilitation. Many studies are small scale case studies, and the 
few large clinical trials have found conflicting results. One study following 63 patients compared using the Lokomat (see ...) to conventional therapy, and found that the robot was less effective \cite{Hidler2008}. There are many challenges in studying the efficacy of robots in a clinical setting. It is unethical to replace traditional therapy with an unproven method, so typically extra therapy is added to the subject's regiment either from a robot or from a therapist (control). Since most robots are designed to replace time spent in conventional therapy, the robot must consistently be shown to be at least as effective as a therapist at delivering rehabilitation. Furthermore, since most robotic devices are substantially different, results from the study of one lower-limb robot may not apply to another robot. All of this makes ''proving`` the efficacy of a rehabilitation robot to the extent that their use becomes more widespread very difficult. That said, there have been many different robotic devices successfully tested, with some even being available commercially. 
	
%----	
		
	
	\begin{table}[]
	\centering
	\caption{Robot Categories}	
	\begin{tabular}{|l|}
		\hline
 		Lower-limb / Upper-limb  \\ \hline
 		End-plate / Exoskeletal \\ \hline
 		Out of bed / Bed-bound  \\ \hline
		\end{tabular}
	\label{tab:motor}
	\end{table}


	
	\subsection{Robots for Gait Training}

	One of the most important activities for lower-limb rehabilitation is gait training, wherein the patient walks with assistance from the therapist. Rehabilitation robots were introduced to provide this assistance by attaching to the patient's leg and guiding them through the correct gait trajectories. This can be accomplished bv an exoskeletal orthosis attached around the knee joint, or by and endplate device which supports and guides the feet. 
	
	The Lokomat, ALEX,, LOPES and ReoAmbulator are examples exoskeletal gait trainers [refs]. Each  comprise of a powered orthosis which can assist the leg through gait trajectories using interaction controllers like impedance control. They all work in conjunction with a treadmill and also usually rely on a harness to prevent falls (also known as bodyweight supported treadmill training). These robots relieve the burden of physically supporting and assisting the patient, and each can accurately move through a gait trajectory with adjustable levels of assistance. One recent study found that the Lokomat was more effective than conventional gait therapy with regards to certain outcome measures \cite{Nam2017}, although another found that it was less effective. The Lokomat is commercially available, 872 devices can be found worldwide according to their website (as of February 2019, ref).
	
%----	
	
	
	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.75\linewidth]{Lokomat}
		\caption{The Lokomat (by Hocoma), an exoskeletal robot}
		\label{fig:Lokomat}
	\end{figure*}
	
	The Haptic Walker and Gait Trainer GTI are examples of end-plate based rehabilitation robots [refs]. Both use actuated platforms under the feet to move the patient through gait trajectories. They use a harness to support the patient. 
	
	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.75\linewidth]{Hapticwalker}
		\caption{The Hapticwalker, an endplate based robot}
		\label{fig:Hapticwalker}
	\end{figure*}
	
	
	Gait training robots show promise for improving gait rehabilitation. However, these only target a single type of lower-limb rehabilitation. Patients must be somewhat mobile (enough to leave their beds and their rooms) to access these devices, and the complexity and setup require that a therapist be present. Hence these robots are designed to replace time spent on conventional therapy, which makes proving consistent performance difficult as was previously mentioned.  
	
	\subsection{Robots for Sitting or Bed-bound Therapy}
	
	Robots for assisting in activities while the patient sits or lies down are less common in the literature. The MotionMaker and Lambda are two examples. 
	
	The MotionMaker consists of a reclinable chair and two orthoses, each with 3 DOF's \cite{Schmitt2004}. It is designed to be used in conjunction with functional electrical stimulation for spinal cord injury patients, but it's application extends to lower-limb rehabilitation in general. 
	
	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.75\linewidth]{Motionmaker}
		\caption{The MotionMaker}
		\label{fig:Motionmaker}
	\end{figure*}
	
	The Lambda is robot developed for general lower-limb rehabilitation and for fitness purposesd \cite{Bouri2009}. It uses parallel linkages with a total of 3 DOFs to achieve a variety of motions. An adjustable seat allows the user to recline as needed. Recent developments include the addition of virtual reality and games to engage the patient, enhanced feedback regarding the patients progress, and multiple types of exercises. 
	
	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.75\linewidth]{Lambda}
		\caption{The Lambda}
		\label{fig:Lambda}
	\end{figure*}
	
	
	The precursor to this project is the Virtual Gait Rehabilitation Robot (ViGRR), a device developed at Carleton University's Advanced Biomechatronics and Locomotion Laboratory \cite{Chisholm2014, Chisholm2010}. It is a 4-DOF end-plate based robot which can assist a reclined patient move through trajectories in the sagittal plane. It works in conjunction with a virtual environment, which the patient can interact with through haptic force-feedback. An admittance controller is used to assist or resist patient movement as desired. It is capable of guiding patient's through a gait trajectory, among other activities. 
	
	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.75\linewidth]{Vigrr}
		\caption{ViGRR}
		\label{fig:vigrr}
	\end{figure*}	
	
	The motivation to create a new device is twofold: creating a lower-powered device suitable for acute stroke rehabilitation, and a smaller and more light-weight device suitable for the hospital environment. 

	
	
	\subsection{Controls} 
	
	The type of controller used is especially important for devices interacting with a human (or any unknown environment), as it will determine the interaction behaviour and stability. The behaviour of the interaction should be optimized to ensure the patient engages in meaningful therapy driving neural plasticity and recovery. Position control through the desired trajectory is not adequate, as the robot will effectively force the limb through the motion, thus becoming a passive motion machine with no necessary engagement from the patient. Neural plasticity requires engagement, \textit{i.e.} need to contribute to some extent to the movement of their limbs. Therefore, rehabilitation robotics should only give some assistance to the patient, instead of leading the motion. 
	
	Four popular control laws for rehabilitation robotics are listed in \cite{Meng2015}.
	
	\begin{enumerate}
		\item Position Control
		\item Impedance/Admittance Control
		\item EMG-based Control
		\item Adaptive Control 
	\end{enumerate}
	
	A basic position controller using for example a PID scheme is easy to implement, but not necessarily useful for stroke rehabilitation. While position control may be good when passive motion is required (\textit{i.e.} the patient does not contribute to the movement), it does not allow for adjusting the amount of assistance applied to the patient. Since patient engagement is critical, position controllers have become much less common. 
	
	Impedance and admittance control were introduced by Hogan in \cite{Hogan1985}, and has been the foundation of most interaction controllers since. These controllers control the interaction between force and position at the interface between the robot and the environment. In this way, an impedance controller can be used to give a programmable amount of assistance to the user through a trajectory, which can be varied by changing the parameters so that an optimal amount of assistance can be obtained for each individual. 
	
	EMG-based control uses electromyography (EMG) to measure muscle activity in the patient. The robot then only provides assistance when the intent to move is detected (\textit{i.e.} the patient flexes their muscle). This is used to ensure the patient is engaged in the exercise, however the EMG does require additional setup time. 
	
	Adaptive control here refers to a controls which changes its behaviour over time based on some predefined law. For example, the amount of assistance supplied by an admittance controller can be changed based on patient performance. Some robots use information from movements in the patient's healthy limb to calculate the optimal control path for the affected limb. For example ...
		
	\subsection{Virtual Environments} \label{Sec:VR}
	
	Virtual environments or virtual reality refer to digitally created simulations or visualizations, typically displayed through headsets or on computer monitors. It combines visuals , auditory stimulation, and haptic feedback to create an immersive experience. Virtual reality has been introduced into rehabilitation for two primary reasons \cite{Laver2015}:
	\begin{itemize}
		\item \textbf{Increase Relevancy}: simulate ADL's and real world activities to introduce context into the exercise, and better prepare the patient these activities outside of the hospital environment.
		\item \textbf{Increase Engagement}: use games and other visuals to make the therapy more exciting and engaging, encouraging more active participation, higher intensity, and higher doses of activity. 
	\end{itemize}

	Virtual reality can be coupled with rehabilitation robotics to further increase immersion. The robot can be used as a control input to the virtual environment, and the robot can in turn deliver haptic feedback to the user. Haptic feedback allows users to interact directly with the virtual world, for example when walking, the ground reaction force can be applied to the user's foot. ...
	
	A metastudy found evidence that VR may improve functional outcomes over conventional therapy, but admits that most studies are small and prone to bias \cite{Laver2015}. One platform used an upper-limb exoskeletal device to apply assistive forces  \cite{Patel2015}. Another study used a Nintendo Wii gaming system to promote therapy, and found it to be a feasible and safe method  \cite{Saposnik2010}. Another study used the Phantom Omni, a pen attached to a robotic arm that can deliver haptic feedback from a virtual environment \cite{Jiang2017}. A serious gaming approach is used in \cite{SociedadeBrasileiradeInformaticaemSaude2014}, where the Unity3D engine is used to create a virtual world and a MS Kinetic sensor to detect the user's motions. 
	
	
\section{Interviews and Shadowing}

%------------------------------------------------------------------------
%-shadowing notes
%
%-------------------------------------------------------------------------
	
	The rise of the human-centred design paradigm underscores the importance of involving end users in the design process, especially when the designers lack expertise in the field of interest. This is certainly the case for this project as none of the engineers involved have ever delivered stroke therapy. As such, the first step of the design process was to consult the end user and collect qualitative data and advice. In the case of rehabilitation robots, there are two types of end-users: the stroke patient using the device, and the therapists who decides when and how to incorporate the device into their rehabilitation regimen. The therapist, however, has greater expertise with stroke rehabilitation in general, and will ultimately be the one who decides the device's fate on the stroke ward. Therefore, it was decided to interview and shadow several PT's and OT's concerning the direction of the project. Patient's were not consulted, due to their lack of expertise in stroke rehabilitation, although their input will be vital in future evaluation experiments. 
	
	Fieldwork was conducted at the Civic campus of the Ottawa Hospital (TOH), in cooperation with Dr. Dariush Dowlatshahi, and with ethics approval from the Ottawa Health Science Network Research Ethics Board (OHSN-REB). Three PT's and two Ot's were recruited for two days of interviews and shadowing. Inclusion criteria included experience working on the stroke ward delivering rehabilitation to stroke patients. Not enough data was collected to perform any meaningful statistic -- instead, key insights were discovered which guided the fundamental concept of the device, and information was gathered not otherwise available through a literature review. 
	
	Some topics of interest included:
	
	\begin{itemize}
		\item Typical acute, bed-bound rehabilitation 
		\item Patient Engagement -- how the therapists keep patients motivated and interactive
		\item The hospital environment 
	\end{itemize}

	
	\subsection{Typical Rehabilitation}
	
	Bed-bound lower-limb rehabilitation is one of the first therapeutic activities administered at the stroke ward, and it continues to be used even after patients are mobile. Bed-bound exercises tend to be simple movements, including knee flexion/extension, leg lifts, hip adduction/abduction, and ankle rolls. All exercises involve the therapist manually manipulation the patients leg, providing assistance to whatever extent the therapist deems necessary. If the patients are advanced, the therapist may choose to resist motion instead of assisting. 
	
	Parameters from typical rehabilitation will help determine the requirements of the new robotic system. Therapists estimated that they exert a maximum of 10 - 15 lbs of force to the leg. The range of motion of patients varied, but many could go through the full range of the leg. The exercises were done slowly at a consistent speed. The role of the therapist can be summarized as providing support to leg and providing assistance through the motion. 
	
	Some patient's are capable of performing bed-bound exercises independent of the therapist. Performing independent practice can increase total rehabilitation dosage and is recommended by stroke guidelines [ref]. However, some patients who are either at an earlier stage of recovery or have suffered more severe strokes are incapable of performing bed-bound exercises without assistance, and so their total dosage is limited to time spent with the therapist. 
	
	\subsection{Patient Engagement} 
	 It is important for the patient to be actively engaged in the exercise. This is accomplished through verbal encouragement, and by requiring the patient to initiate the movement. Therapists also used physical cues to guide the patient, for example by tapping the leg if it needs adjusting. Many of the patients required verbal or physical engagement throughout the whole process. This is in part due to a phenomenon known as neglect, wherein the stroke victim has trouble focusing on the effected side of the body. Sometimes, pictures and posters (\textit{e.g.}of cats and dogs) were posted in front of many of the exercise machines in the therapy room. Another common practice is to switch to a new exercise if the patient is showing signs of losing focus. 
	 
	 \subsection{Hospital Environment}
	Space in the hospital is limited. Many rooms house four patients, and are often crowded by hospital staff, family, and equipment. The beds themselves vary in model and size, but all have some common characteristics: movable guards on the side, removable baseboard, tiltable frame controlled from a panel. There appear to only be outlets behind the beds near the floor, but this will again vary from room to room. 
	There is also a therapy room where more advanced patients go to practice sit-to-stand, walking, stair-climbing, etc. This room is more spacious and also includes beds (albeit simpler beds that cannot be tilted and that do no have guards). 
	
	\subsection{Therapy Schedule}
	
	Therapists generally have a high workload and so must carefully schedule time with patients. At this particular hospital, patients got on average 30 minutes every other day with a physiotherapist for lower-limb rehabilitation. Most patients were fatigued by the end of the session, and so increasing the duration is not reasonable. However, the therapists recognized that the patients could benefit from more sessions throughout the week. 
	
	\subsection{Other Comments and Concerns}
	
	Most therapists had concerns over safety. They recognized that the robot could potential apply forces which could harm the patient. One point of concern was rotation of the leg out of position such that the force was applied incorrectly. For example, during the knee flexion/extension exercise, if the leg were to rotate out of the sagittal plane, the robot could apply a torque about the hip which would bend the leg further and potential injure the patient. Therapists suggested having multiple support points along the leg to keep the leg in position. 
	
	Other comments included the need for comfort, particularly using comfortable material where the robot and human interact. The potential use of tactile methods of engaging the patient (\textit{e.g.} tapping or vibrations applied to the leg). Some indicated that combining upper and lower-limb activities could be beneficial (\textit{e.g.} by using a joystick with the robot). 
	
	
\section{Device Concept} 

Our goal is to design a lower-limb rehabilitation robot targeting acute patients by creating a device compatible with a patient who is lying or reclined in a hospital bed. The device should be a viable tool for therapists to use to increase functional outcomes for their patients. It should replicate the role of the therapist when providing assistance for bed bound exercises. There are three primary roles:

\begin{enumerate}
	\item Support Leg 
	\item Provide Assistance through the motion
	\item Engage the patient
\end{enumerate}

Supporting the leg will be accomplished through the physical structure of the device. Assistance will be provided using force feedback and interaction controllers which can ensure that the patient is contributing to some extent. The patient will be engaged using visualizations, virtual environments, and haptic feedback. 

Bed-bound exercises include a variety of simple movements, such as leg lifts, knee extensions, and hip abductions. Since this device is a proof-of-concept, it was decided that we would initially target a single exercise, evaluate its performance in the hospital, and then extend to target other exercises by adding degrees-of-freedom. We chose the knee flexion/extension exercise for the following reasons:

\begin{itemize}
	\item It is a commonly used bed-bound exercise
	\item It is important due to its relation to the sit-to-stand activity, which is the first stage of getting the patient mobile
	\item ...
\end{itemize}
 
The knee flexion/extension exercise requires just a single horizontal degree-of-freedom. The therapist uses one hand to support the leg under the knee, and the other hand to support the foot and apply force through the heel. They slowly move the leg back and forth, encouraging the patient to push. They are careful to keep the leg aligned in the sagittal plane. 

There are several use cases for the device. The therapist could use during therapy instead of manually moving the legs. This would relieve them of the physical burden, the virtual environments may encourage the patient to participate more, and the data collected could be used to track progress. The therapist could use multiple devices simultaneously to provide care to multiple patients. This would allow them to see more patients and thus increase therapy dosage. Finally, since the device replicates the role of the therapist, the device could be used separately from the therapist, under the supervision of other hospital staff. This would encourage patient's to practice independently, thereby increasing therapy dosage. 

In addition to these requirements, the device should be usable within a hospital environment. The device should be safe such that the patient is not harmed, and should also be perceived as safe so that the therapists and patients are willing to use it. The device should fit on a hospital bed, and should be lightweight and small enough to be manageable within a hospital room. The set-up of the device should be quick and easy.



%---
%We set out to design a simple lower-limb rehabilitation for acute, bed-bound stroke patients. We chose to design for the knee flexion-extension exercise because it is most related to sit-to-stand, which is the most important activity for bed-bound patients to recover as it allows the patient to get up and begin gait rehabilitation. The robotic configuration best suited to this exercise is a one degree of freedom linear actuator. 


%Stroke rehabilitation best practices were outlined in the previous section. A few key recommendations highlight the potential benefits of introducing a simple-to-use robotic device into the rehabilitation arsenal. The robotic device would primarily be used to offer additional rehabilitation time to patients under the supervision of a nurse or other responsible person. The gaming aspect of the system would ensure the patient is engaged in the exercise, and also offer feedback so that the patients movements can be regulated even in the absence of a therapist. The games and visualizations could also be tailored to simulate ADL's. Therefore, a robotic device could theoretically boost outcomes by covering the following recommendations:



\section{Contributions and Outline}

A one DOF robot was designed and created, consisting of a DC motor, force sensor, belt drive, footplate, frame, and a number of smaller components. A printed circuit board (PCB) was created to route signals, do preprocessing, and distribute power. System software was implemented on a real-time linux system. A controller was created in C, which can do admittance control, haptic feedback, a basic physics engine, communication with a UI server, and data logging. Real time functionality is ensured using POSIX standards for memory locking, multi-threading, etc. The UI is implemented as website using the React framework, and some simple games are created using THREE.js 3D web graphics library. Preliminary experiments are run, include functionality tests, and healthy subject testing. 

Chapter 2 covers the design of the device. This includes preliminary design choices, the design of the physical structure, the actuation and sensors, the design of the electronics (power distribution, signal routing and preprocessing), and the chosen computer hardware. 

Chapter 3 covers the controller and its implementation in the software, including the basic admittance control, and the haptic feedback with physics engine. The design of the user interface (UI) and some basic games/visualisations are also discussed. The communication and the overall software design within real-time Linux is explained, including the how the modular design will allow it to be easily adapted to future design iterations. 

Chapter 4 covers testing and experiments, including functional testing of the software, controller, and UI. The methods and results from a small study on healthy subjects are presented, with questionnaire answers regarding the subjective experience of participants, along with quantitative performance metrics. 

Chapter 5 concludes with a summary of contributions and recommendations for future work. This includes features that were required which have not yet been implemented due to time constraints, and ideas for future direction of the project. 

\chapter{Device Design and Implementation}
	\section{Overview}

	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.75\linewidth]{Robot_labeled}
		\caption{Admittance Verification with Interaction}
		\label{fig:VerInt}
	\end{figure*}
	
	\section{Structural Design}

	\section{Hardware}
		\subsection{Actuator}
		
	The system is actuated using a Brushed DC Motor, gear reduction, coupling, and an off-the-shelf linear belt drive. The Brushed DC Motor is a Maxon RE 50 200W Graphite Brush model (part number 370354). The gear reduction is the Maxon GP 52C Planetary Gearhead (part number 223090). The coupling is an Aluminium Flexible Shaft Coupling with polyurethance spider from McMaster-Carr. The linear belt drive is a LB250-24 Belt Drive from Anaheim Automation. The motor is mounted to the belt drive using custom machined aluminium mounts. 
	
	\begin{table}[]
	\centering
	\caption{DC Motor Properties}	
	\begin{tabular}{|l|l|}
		\hline
		\textbf{Property} & \textbf{Value}  \\ \hline
 		Nominal Voltage & 24V  \\ \hline
 		Torque Constant & 38.5 mNm/A \\ \hline
 		Speed Constant & 248 rpm/V  \\ \hline
 		Stall Torque & 8.92 Nm \\ \hline
		\end{tabular}
	\label{tab:motor}
	\end{table}
	
	\begin{table}[]
	\centering
	\caption{Gear Reduction Properties}	
	\begin{tabular}{|l|l|}
		\hline
		\textbf{Property} & \textbf{Value}  \\ \hline
 		Reduction & 53:1  \\ \hline
 		Max Speed Input & 6000 rpm  \\ \hline
 		Max Torque Input & 45 Nm  \\ \hline
		\end{tabular}
	\label{tab:gear}
	\end{table}
	
	\begin{table}[]
	\centering
	\caption{Belt Drive Properties}	
	\begin{tabular}{|l|l|}
		\hline
		\textbf{Property} & \textbf{Value}  \\ \hline
		Stroke Length & 24 in  \\ \hline
 		Travel per Revolutions & 4.8 in/rev  \\ \hline
 		Maximum Travel Speed & 100 in/s  \\ \hline
 		Static Load capacity & 1000 lb  \\ \hline
 		Dynamic Load Capacity & 200 lb  \\ \hline
		\end{tabular}
	\label{tab:belt}
	\end{table}
	
	 
		
		\subsection{Sensors}

	A total of five sensors are used on the device, including: a load cell, two limit switches, a quadrature encoder, and an infrared (IR) proximity sensor. The load cell and encoder are used to measure force and relative change in position for use in the controller; the limit switches are used to sense if the carriage as reached the end of the stroke in the front or back of the device, and the IR sensor detects the user's foot on the footplate to ensure the device can be deactivated if the foot is removed or if no one is using it. 		
		
	\section{Electronics and Power}
	
	Custom electronics were needed in order to power and operate the sensors, and send command signals to the motor. As such, a printed circuit board (PCB) was created. It includes voltage regulator's to down-step? the voltage from the 48v power supply, routing to cleanly connect the DAQ with the sensors, and several integrated circuits (IC's) to perform signal processing. 
	
	
	
		\subsection{Components}
		
	\begin{table}[]
	\centering
	\caption{PCB Components}	
	\begin{tabular}{|l|l|}
		\hline
		\textbf{Component} & \textbf{Description}  \\ \hline
		24 V DC/DC Converter & Converts 48V to 24V  \\ \hline
		10 \& 5V Linear Regulator & Converts 48V to 10V and 5V  \\ \hline
		OP-AMP & Signal Processing   \\ \hline
		Comparator & Checks to ensure commands are not above/below threshold   \\ \hline
		4 Channel AND Gate & Only enables operation if all saftey checks read ok   \\ \hline
		Watchdog Timer & Ensures controller is still running \\ \hline

		\end{tabular}
	\label{tab:belt}
	\end{table}
		
		\subsection{PCB Layout}
		
	\begin{figure*}[t] 
		\centering
		\includegraphics[width=0.9\linewidth]{pcb_schematic}
		\caption{Printed Circuit Board}
		\label{fig:pcb}
	\end{figure*}
	
	\section{Data Acquisition} 

	Data acquisition is handled by a LabJack T7 DAQ. This model has 14 analog inputs, 2 analog outputs, 23 digital I/O's, and is also capable of handling quadrature encoder signals and high-speed data streaming. The device can interface with the computer through a Ethernet, USB, or wifi (Ethernet was chosen for this project as it is the fastest and most reliable). The front-end Modbus TCP interface is conveniently packaged in the C/C++ LJM library, discussed further in chapter ... 

\chapter{Controller and Software}

	\section{Overview}
	\section{Impedance \& Admittance Controller}

%------------------------------------------------------------------------
%-Explain force control
%	-choice of impedance over admittance
%-Implementation in code
%
%-------------------------------------------------------------------------	

When controlling a robot which is interacting with an unknown environment, force and position control online may behave unpredictable or even become unstable. Instead, the relation between force and velocity (\textit{i.e.} the impedance) ...


Impedance control accepts a velocity and renders a force. Fundamentally, impedance control can be described by the following equation, where $F$ is the force control input, $Z$ is the desired impedance, and $V_R$ is the 'flow' variable vectors (e.g. position and velocity) :

\begin{equation}
	F = ZV_R 
\end{equation} 

It is common to characterize the desired impedance in terms of a mass, spring and damper system with parameters $m$, $b$, and $k$, respectively. Furthermore, a desired position can also be integrated into the equation by changing the reference point of the spring. 

\begin{equation}
	F = m\ddot{x} + b\dot{x} + k(x - x_{des})
\end{equation} 

Using this control law, the end effector of the robot will behave like the system above, about point $x_{des}$, when displaced by the external environment. If, for example, an operator physical moved the robot, it would respond as if it were the mass-spring-damper system, \textit{i.e.} it would apply a resistive force related to the extent to which it was displaced. 
	This control law rests on a significant assumption -- that the robot itself has no inherent impedance between the actuator and the the end-effector. This is an idealization - there will also be some level of friction, mass, or other impeding factors in the motor, gears, links, etc. Therefore, impedance control should only be considered for robots made of low impedance components, such as belt drives and direct-drives. 
	
	Admittance control is essentially the inverse of impedance control, in that it accepts an external force and then renders a corresponding displacement. Fundamentally, admittance control can be described by the following equation, where $F_R$ is the force applied to the robot, $Y$ is the desired admittance, and $V$ is the 'flow' variable vectors (e.g. position and velocity) :
	
	\begin{equation}
	V = YF_R 
	\end{equation} 
	
	Once again, it is common to define admittance in terms of a mass-spring-damper system (\ref{eqn:adm}). Here, $x_a$ and $v_a$ are the ``simulated'' position and velocity determined by the admittance controller. Additionally, to actually render the desired position and velocity, an outer-loop PD position controller is used (\ref{eqn:PD}), with $x_a$ and $v_a$ acting as the desired position and velocity. 
	
	\begin{gather} \label{eqn:adm}
	\begin{bmatrix}
    	\dot{x}_a \\
    	\dot{v}_a 
    \end{bmatrix} 
    =
    \begin{bmatrix}
    	0 & 1 \\
    	\frac{k}{m} & \frac{b}{m}
    \end{bmatrix} 
    \begin{bmatrix}
    	x_a \\
    	v_a
    \end{bmatrix}  
    +
    \begin{bmatrix}
    	0 \\
    	\frac{1}{m}
    \end{bmatrix}
    F_R   	
	\end{gather}
	
	\begin{equation} \label{eqn:PD}
	F = P(x - x_a) + D(v - v_a)
	\end{equation}

	Admittance control assumes that the robot has infinite impedance, or that all hardware between the actuator and the end-effector is infinitely stiff, infinitely damped, etc. This, once again, is an idealization -- and therefore admittance control should only be considered when the robot has high impedance, i.e. when using large gear reductions and rigid links. 
	
	Another point of consideration when choosing between impedance and admittance control is its stability when encountering different types of environments. It is convenient to model the interaction as a two-port
	Impedance control works better when interacting with an admittance (rigid environments), whereas admittance control works better when interacting with an impedance (weak environment / free space). 
	
	This project targets acute stroke patients who typically do not have much leg strength and rely heavily on assistance from the therapist during therapy. Therefore, these patients can be modeled as an impedance. Furthermore, the motor used on the robot has a high gear reduction which contains substantial impedance. Both of these favour using admittance control. 
	
	

	\section{Haptic Coupling}
%------------------------------------------------------------------------
%-1 DOF physics engine 
%-strategies to create haptics 
%	-changing imp params
%	-virtual coupling
%
%-------------------------------------------------------------------------

Defining the desired impedance or admittance in terms of a mass-spring-damper system is not always convenient. Ideally, one could define an arbitrary impedance or admittance function relating $F$ and $V$, giving complete control of the behaviour of the robot-environment interaction, while also ensuring stability. The dual goals of imposing a 
	
	A method for achieving arbitrary interaction and remaining stable is discussed in \cite{Adams1999}, using what is called a ``haptic coupling''. This effectively decouples the design on the admittance/impedance and analysis of the stability of the robot. Consider again the two-port model of the robot-environment interaction. The haptic coupling is a virtual passive system placed in between the two, which acts as a low pass filter on the variables. This limits the range of renderable impedances, and while it does alter the desired impedance to some extent, the trade off is guaranteed stability. Using the concept of the haptic coupling, a simple physics engine was designed which works in conjunction with the games and visualization. 
	
	In addition to decoupling stability and the design of the haptic environment, the haptic coupling also allows both impedance and admittance to be used together. For example, a robot may use admittance control due to large amounts of drive friction, but the haptic environment may need to be defined as an impedance, \textit{i.e.} using position to calculate the desired haptic force. 
	
	\begin{equation}
		Z(s) = \frac{F}{v} = ms + b  
	\end{equation}
	\begin{equation}
		Z(z) = \frac{mb(z-1)}{(m+bT)z - m}
	\end{equation}
	
	
	\section{Tuning Control Gains}

	Some control gains must tuned for optimal performance and stability, which include:
	
	\begin{enumerate}
		\item P \& D for the position PD controller 
		\item b \& m for the haptic coupling ()
		\item $I_{max}$ on the motor controller, giving the current command given to the motor at the maximum motor command of $\pm 10V$
	\end{enumerate}		
	
	Other controller gains are set based on the desired behaviour of the device -- these require bounds so that the user does not enter bad parameters:
	
	\begin{enumerate}
		\item K,B,M for the admittance controller
		\item $V_{max}$ for trajectory generation
		\item $F_{max}$ for the maximum force generated by the system
	\end{enumerate}
	
	...
	
	First, the PD controller can be tuned separately from the admittance. The PD controller can be though of as another impedance existing within the system, and should therefore be tuned as high (stiff) as possible for optimal performance of the admittance controller. The P gain should be set such that the largest position error corresponds with the maximum motor command.
	
	The maximum motor command at the motor controller is $\pm 10V$, however the motor command sent from the DAQ is multiplied by a factor of approximately 4 and referenced to a constant $10 V$. Therefore the maximum command sent from the controller is between 0 (maximum current in one direction) to 5 (maximum current in the other direction). 
	
	The maximum displacement can be calculated by using the maximum velocity achievable by the actuator. In this case that is $9 in/s$, which corresponds to a maximum displacement of about $0.23 mm/step$ for a controller running at 1000 Hz. However, designing for this displacement will be conservative in that the gains will be very small. Furthermore, since the system is interacting with a person whose behaviour is unknown, there is always the chance the system will be driven beyond the limits. Therefore it was decided to design the PD controller based on a maximum step of 2mm, and to then try and enforce the maximum velocity of $9 in/s$ through visual feedback to the user.
	
	Given these parameters, the P gain should be set to 2.4:
	
	\begin{align*}
		cmd_{max} &= P\Delta x \\
		P &= \frac{cmd_{max}}{\Delta x} = \frac{4.8}{2} =  2.4
	\end{align*}
	
	Next, the D gain is determined empirically by increasing it until there is no overshoot to a step response ....
	
	The limits on the admittance parameters can now be determined. The admittance system can be approximated by the following:
	
	\begin{equation}
		\Delta v = - \frac{K}{M}x - \frac{B}{M} + \frac{1}{M}F
	\end{equation}
	
	We want to avoid producing a change in position greater than 2mm as per the PD controller tuning. Therefore, the maximum velocity of the admittance model should not exceed 2000 mm/s (for a controller running at 1 kHz). Therefore, $\Delta v$ should be equal to zero at this maximum velocity and at the maximum achievable spring force, \textit{i.e.} when the error between actual position and reference position is maximum. Therefore:
	
	\begin{align}
		0 &= -K(400mm) - B(2000mm/s) + 222.4N \\
		K &\leq 0.556 - 5B   
	\end{align}
	
	he mass is factored out, and the maximum error in position, maximum velocity, and the maximum force are entered. This defines space bounded by a line in which the $(K,B)$ vector must lie. Furthermore, there is a minimum constraint on the damping (B) since it is the dissipative element and is therefore required for passivity and stability. This constraint, $B_{min}$ is found empirically by setting K high and finding the minimum B to make the system behave in a stable manner. ...

	The mass does not affect the rendered impedance, but instead determines the systems sensitivity to force. The smaller the mass, the smaller the force that is required to achieve a certain state ... There is therefore no real maximum mass, however at some point a high mass will make the system impossible to move. There is a minimum mass, below which the sensitivity to force allows sensor noise or unmodeled dynamics to effect the system to an undesirable extent. 
	
	...
	
	Finally, the haptic coupling parameters $m$ and $b$ should be set. As was explained in Sec. , these parameters give the controller some minimum impedance so that the haptics do not try to render an impedance too close to free motion. Therefore, the parameters are set to the empirically derived $B_{min}$ and its pair $K_{min}$. This decouples the haptic design from the stability of the controller by imposing the minimum impedance for the stability. The maximum constraints are however still not imposed. Fortunately, the haptics explicitly calculate either the desired force or the desired next position, and therefore the constraints on these parameters can be directly imposed. 
		
	\section{Physics Engine}
	
			
		
	\section{Real Time Operation and Linux}
	
%------------------------------------------------------------------------
%-Explain Real time
%	-features
%-Explain Linux Real time
%	-POSIX
%-Details of robot software (threads, libraries, memory ...)
%	-threads, memory sharing 
%
%-------------------------------------------------------------------------

		
	\section{Software Design -- Controller}
	\section{Software Design -- User Interface} 
	
\chapter{Experiments}
	\section{Safety Tests}
	\section{Functional Tests}

	\subsection{Verifying Admittance Control}
		
	The goal of admittance control is to achieve a desired dynamic behaviour, usually in terms of a mass-spring-damper system, given some input force. To confirm that the controller is successfully rendering the desired admittance, the output position of the device was compared to a simulation of the desired admittance. Force was applied to the system, and data regarding the position and the input force was saved. The force data was used as an input to a Simulink simulation of the mass-spring-damper system, and both the robots position and the simulated position were compared. It was expected that the robot position would track the simulation with some minimal delay due to time lag introduced by the finite sampling rate, as well as some possible error due to limitations of the robots PD control. 
	
	For the first test no interaction force was applied, only an initial offset of the reference position of the spring (of 0.2m) was used to elicit a response. A comparison of the robot's behaviour and the simulated behaviour of the desired admittance behaviour is given in (). Force was applied to the robot in the second test, in order to verify that the controller reproduced the desired admittance when interacting with an unknown environment. ... 
	
	
\begin{figure*}[t] 
	\centering
	\includegraphics[width=0.9\linewidth]{Mar12_NoForce_Step_Plot}
	\caption{Admittance Verification with Interaction}
	\label{fig:nVerNoInt}
\end{figure*}

\begin{figure*}[t] 
	\centering
	\includegraphics[width=0.9\linewidth]{Mar12_RandForce_Plot1}
	\caption{Admittance Verification with Interaction}
	\label{fig:VerInt}
\end{figure*}
	
	These tests confirm that the admittance controller adequately recreated the desired dynamics, and that the outer-loop PD controller tracked this behaviour. 
	
	\subsection{Verifying Haptic Control}
	
	\section{Healthy Subject Experiments}
	
\chapter{Conclusion}
	\section{Future Work}
	
	
\bibliography{thesis}
\bibliographystyle{ieeetr}
\end{document}